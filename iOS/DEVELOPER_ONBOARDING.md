# Developer Onboarding Guide

Welcome to the Chess App team! This guide will help you get up and running quickly.

## What You Need to Know

### Project Structure

```
ChessApp/
â”œâ”€â”€ Model/                    # Business logic and state management
â”‚   â”œâ”€â”€ GameManager.swift     # ChessGameState - core game logic
â”‚   â”œâ”€â”€ ChessCoachAPI.swift   # Backend API client
â”‚   â”œâ”€â”€ RuleEngine.swift      # Chess rules validation
â”‚   â”œâ”€â”€ MoveHistoryManager.swift
â”‚   â”œâ”€â”€ AuthenticationManager.swift
â”‚   â””â”€â”€ AnalyticsManager.swift
â”œâ”€â”€ View/                     # SwiftUI views
â”‚   â”œâ”€â”€ ContentView.swift
â”‚   â”œâ”€â”€ ChessBoardView.swift
â”‚   â”œâ”€â”€ LoginView.swift
â”‚   â”œâ”€â”€ GameControlsView.swift
â”‚   â”œâ”€â”€ SettingsView.swift
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Config/                   # Configuration
â”‚   â”œâ”€â”€ FeatureFlags.swift
â”‚   â””â”€â”€ Secrets.swift         # âš ï¸ Generated by setup.sh, DO NOT commit
â”œâ”€â”€ .env.example              # Environment variable template
â”œâ”€â”€ setup.sh                  # Setup script to generate Secrets.swift
â””â”€â”€ SETUP.md                  # Detailed setup instructions
```

### Key Technologies

- **SwiftUI** - UI framework
- **Observation** - State management (`@Observable` macro)
- **Swift 6** - Latest Swift version with concurrency safety
- **URLSession** - Networking
- **UserDefaults** - Local preferences storage

## Getting Started (5 minutes)

### 1. Clone and Open

```bash
git clone <repo-url>
cd ChessApp/iOS
open ChessApp.xcodeproj
```

### 2. Set API Key in Xcode Scheme

1. **Product** > **Scheme** > **Edit Scheme**
2. Select **Run** on the left
3. Go to **Arguments** tab
4. Under **Environment Variables**, click **+** and add:
   - **Name:** `CHESS_COACH_API_KEY`
   - **Value:** (ask team lead for the production key)
5. Click **Close**

### 3. Build and Run

- Press `Cmd+B` to build
- Press `Cmd+R` to run
- Press `Cmd+U` to run tests (when available)

## Architecture Overview

### Game State Management

All game state lives in `ChessGameState` (GameManager.swift):

```swift
@Observable
class ChessGameState: @unchecked Sendable {
    var board: [[ChessPiece?]]           // 8x8 board state
    var currentPlayer: ChessColor        // White or Black
    var gameStatus: GameStatus           // In Progress, Checkmate, etc.
    var chessCoachAPI: ChessCoachAPI     // Backend integration
    // ... more state properties
}
```

### API Integration

`ChessCoachAPI` handles all backend communication:

```swift
@Observable
class ChessCoachAPI: @unchecked Sendable {
    func createSession() async throws -> SessionResponse
    func analyzeMove(sessionId: String, move: String) async throws -> MoveAnalysisResponse
    func resetSession()  // Clear session when switching backends
}
```

### Settings Management

Settings are stored in `UserDefaults`:

```swift
// Read
let apiURL = UserDefaults.standard.string(forKey: "ChessCoach.apiBaseURL")

// Write
UserDefaults.standard.set(value, forKey: "ChessCoach.apiBaseURL")
```

### Secrets Handling

**Important:** Never hardcode secrets in Swift files!

Instead:
1. Add credential to `.env`
2. Run `./setup.sh` to generate `Secrets.swift`
3. Access via: `Secrets.chessCoachAPIKey`

```swift
// ChessCoachAPI.swift
self.apiKey = Secrets.chessCoachAPIKey
```

## Common Development Tasks

### Adding a New Feature

1. Add state to `ChessGameState` if needed
2. Create new view in `View/` directory
3. Connect view to state via `@Bindable` or `@Environment`

### Debugging Game State

Enable debug mode in Settings to see:
- Move history
- Current game status
- API responses

### Testing API Connection

1. Open Settings in the app
2. Click "Test Connection"
3. Should see "âœ… Success" if backend is reachable

### Switching Between Production and Local Dev

In Settings:
1. Click "Production" for cloud backend
2. Click "Local Dev" for `http://localhost:8000`
3. This automatically resets the current game

## Secrets Management

### Never Hardcode API Keys

- **Never** put API keys in Swift source code
- **Never** commit API keys to git
- Always use environment variables or app settings

### How Environment Variables Are Read

The app reads API keys using:

```swift
ProcessInfo.processInfo.environment["CHESS_COACH_API_KEY"]
```

This is set via:
1. **Xcode Scheme** (Product > Scheme > Edit Scheme > Arguments) - For development
2. **CI/CD secrets** - GitHub Actions or similar for production

### For Different Environments

**Development:**
- Set `CHESS_COACH_API_KEY` in Xcode scheme
- Each developer has their own scheme configuration

**Production:**
- Set in CI/CD secrets (e.g., GitHub Actions)
- Backend: `https://ai-chess-coach-backend-ed3d4b2641bc.herokuapp.com`

## Troubleshooting

### API calls failing with 401/403 Unauthorized

Check:
1. `CHESS_COACH_API_KEY` is set in Xcode scheme (Product > Scheme > Edit Scheme > Arguments)
2. API key value is correct and hasn't expired
3. Backend is reachable
4. Use "Test Connection" in app Settings

### App shows nil API key errors

Make sure you've:
1. Set `CHESS_COACH_API_KEY` in Xcode scheme
2. Clicked **Close** to save the scheme changes
3. Restarted the app after adding the variable

### Settings show empty API key

This is normal - Xcode scheme variables don't auto-populate Settings UI. You can:
1. Type API key directly in Settings UI
2. Or rely on the Xcode scheme environment variable (app will use it automatically)

## Common Pitfalls

1. **Forgetting to set environment variable** - Won't work without it
2. **Not saving Xcode scheme changes** - Click **Close** after adding variables!
3. **Hardcoding API keys** - Always use environment variables
4. **Not checking console logs** - API errors are logged with category `.api`

## Useful Commands

```bash
# Build the project
xcodebuild build -project ChessApp.xcodeproj -scheme ChessApp

# Run tests
xcodebuild test -project ChessApp.xcodeproj -scheme ChessApp

# View logs in Xcode
# Menu: View > Inspectors > Show Console (Cmd+Shift+C)

# Check if file is gitignored
git check-ignore <filename>
```

## Code Style

- Follow existing code patterns
- Use `logDebug()`, `logInfo()`, `logError()` for logging
- Add `// MARK:` comments to organize code sections
- Use `@Observable` for state classes
- Use `@MainActor` for UI-related classes

## Getting Help

1. Check SETUP.md for setup issues
2. Review GameManager.swift for game logic questions
3. Check ChessCoachAPI.swift for API integration
4. Ask your tech lead for architectural questions

## Important Files to Know

| File | Purpose |
|------|---------|
| `GameManager.swift` | Core game state and logic |
| `ChessCoachAPI.swift` | Backend API client |
| `SettingsView.swift` | User preferences UI |
| `ChessBoardView.swift` | Game board rendering |
| `.env.example` | Environment variable template |
| `setup.sh` | Generates Secrets.swift from .env |
| `SETUP.md` | Detailed setup guide |

Welcome to the team! ğŸ‰
